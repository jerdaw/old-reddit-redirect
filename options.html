<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Old Reddit Redirect - Options</title>
    <link rel="stylesheet" href="options.css" />
  </head>
  <body>
    <div class="container">
      <h1>Old Reddit Redirect</h1>

      <!-- Main Toggle -->
      <section class="setting">
        <div class="setting-row">
          <div class="setting-info">
            <label for="toggle-redirect">Enable Redirect</label>
            <p class="description">
              Automatically redirect Reddit URLs to old.reddit.com
            </p>
          </div>
          <label class="switch">
            <input type="checkbox" id="toggle-redirect" checked />
            <span class="slider"></span>
          </label>
        </div>
      </section>

      <!-- Statistics -->
      <section class="setting">
        <h2>Statistics</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-number" id="total-redirects">0</span>
            <span class="stat-label">Total Redirects</span>
          </div>
          <div class="stat-card">
            <span class="stat-number" id="today-redirects">0</span>
            <span class="stat-label">Today</span>
          </div>
        </div>

        <!-- Weekly Trend Chart -->
        <div class="chart-container">
          <h3>Last 7 Days</h3>
          <div class="bar-chart" id="weekly-chart">
            <!-- Populated by JS -->
          </div>
        </div>

        <div class="stats-detail">
          <h3>Top Subreddits</h3>
          <ol id="top-subreddits" class="subreddit-list">
            <!-- Populated by JS -->
          </ol>
          <p class="empty-state" id="subreddit-empty">
            No subreddit data yet. Visit some subreddits to see stats!
          </p>
        </div>
        <div class="stats-actions">
          <button class="button secondary" id="export-stats">
            üìä Export Stats
          </button>
          <button class="button secondary" id="clear-stats">
            Clear Statistics
          </button>
        </div>
      </section>

      <!-- Visual Preferences -->
      <section class="setting">
        <h2>Visual Preferences</h2>

        <div class="option-row">
          <label for="icon-click-behavior">Icon Click Behavior</label>
          <select id="icon-click-behavior" class="select-input">
            <option value="popup">Open popup (default)</option>
            <option value="toggle">Toggle redirect on/off</option>
          </select>
          <p class="option-description">
            Choose what happens when you click the extension icon. Keyboard
            shortcut always toggles regardless of this setting.
          </p>
        </div>

        <div class="option-row">
          <label for="badge-style">Badge Style</label>
          <select id="badge-style" class="select-input">
            <option value="text">Text ("OFF" when disabled)</option>
            <option value="count">Redirect count</option>
            <option value="color">Color only</option>
          </select>
          <p class="option-description">
            How the extension icon badge should display
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="animate-toggle" checked />
            <span>Animate icon on toggle</span>
          </label>
          <p class="option-description">
            Flash the badge color when toggling redirect on/off
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="show-notifications" />
            <span>Show notifications</span>
          </label>
          <p class="option-description">
            Show browser notifications for redirect events
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="show-redirect-notice" />
            <span>Show redirect notice</span>
          </label>
          <p class="option-description">
            Show a small notification on old.reddit.com after redirect with "Go
            back" option
          </p>
        </div>
      </section>

      <!-- Dark Mode -->
      <section class="setting">
        <h2>Dark Mode for old.reddit.com</h2>
        <p class="section-description">
          Apply a dark theme to old Reddit that respects your system
          preferences.
        </p>

        <div class="option-row">
          <label for="dark-mode">Dark Mode</label>
          <select id="dark-mode" class="select-input">
            <option value="auto">Auto (follow system preference)</option>
            <option value="light">Light</option>
            <option value="dark">Dark</option>
            <option value="oled">OLED Black</option>
          </select>
          <p class="option-description">
            Choose when to apply dark mode. "Auto" follows your system's
            light/dark preference. "OLED Black" uses pure black for OLED
            screens.
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="auto-collapse-automod" checked />
            <span>Auto-collapse bot comments</span>
          </label>
          <p class="option-description">
            Automatically collapse AutoModerator and common bot comments when
            loading comment threads
          </p>
        </div>
      </section>

      <!-- Comment Enhancements -->
      <section class="setting">
        <h2>Comment Enhancements</h2>
        <p class="section-description">
          Improve the comment reading experience with visual enhancements.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="color-coded-comments" checked />
            <span>Color-coded comment depth</span>
          </label>
          <p class="option-description">
            Add colored stripes to the left edge of comments indicating nesting
            depth. Helps visually track conversation threads.
          </p>
        </div>

        <div class="option-row">
          <label for="color-palette">Color Palette</label>
          <select id="color-palette" class="select-input">
            <option value="standard">Standard (Rainbow)</option>
            <option value="colorblind">Color-Blind Friendly</option>
          </select>
          <p class="option-description">
            Choose color palette for comment depth indicators. Color-blind
            palette uses distinct hues optimized for accessibility.
          </p>
        </div>

        <div class="option-row">
          <label for="stripe-width">Stripe Width</label>
          <select id="stripe-width" class="select-input">
            <option value="2">Thin (2px)</option>
            <option value="3">Medium (3px)</option>
            <option value="4">Thick (4px)</option>
            <option value="5">Extra Thick (5px)</option>
          </select>
          <p class="option-description">
            Width of the colored stripe on the left edge of comments.
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="navigation-buttons" checked />
            <span>Comment navigation buttons</span>
          </label>
          <p class="option-description">
            Show floating buttons to jump between top-level comments. Use
            Shift+J/K for keyboard navigation.
          </p>
        </div>

        <div class="option-row">
          <label for="nav-button-position">Button Position</label>
          <select id="nav-button-position" class="select-input">
            <option value="bottom-right">Bottom Right</option>
            <option value="bottom-left">Bottom Left</option>
          </select>
          <p class="option-description">
            Choose where the navigation buttons appear on the screen.
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="inline-images" checked />
            <span>Inline image expansion</span>
          </label>
          <p class="option-description">
            Add expand buttons next to image links in comments. Click to view
            images inline without opening a new tab.
          </p>
        </div>

        <div class="option-row">
          <label for="max-image-width">Maximum Image Width</label>
          <select id="max-image-width" class="select-input">
            <option value="400">Small (400px)</option>
            <option value="600">Medium (600px)</option>
            <option value="800">Large (800px)</option>
            <option value="0">Full Width</option>
          </select>
          <p class="option-description">
            Maximum width for expanded images. "Full Width" uses the comment
            area width.
          </p>
        </div>
      </section>

      <!-- Sort Preferences -->
      <section class="setting">
        <h2>Subreddit Sort Preferences</h2>
        <p class="section-description">
          Automatically apply your preferred sort order (new, top, rising, etc.)
          when visiting subreddits. Your preference is saved when you manually
          change the sort order.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="sort-preferences-enabled" checked />
            <span>Remember sort order per subreddit</span>
          </label>
          <p class="option-description">
            Enable automatic sort order application when visiting subreddits
          </p>
        </div>

        <div class="sort-preferences-management" id="sort-prefs-container">
          <div class="prefs-header">
            <h3>
              Saved Preferences
              <span class="pref-count"
                >(<span id="pref-count">0</span>/<span id="pref-max">100</span
                >)</span
              >
            </h3>
            <div class="prefs-controls">
              <input
                type="text"
                id="pref-search"
                placeholder="Search subreddits..."
                class="search-input"
              />
              <button
                id="export-prefs"
                class="secondary-button"
                title="Export preferences as JSON"
              >
                Export
              </button>
              <button
                id="import-prefs"
                class="secondary-button"
                title="Import preferences from JSON"
              >
                Import
              </button>
              <button
                id="clear-all-prefs"
                class="danger-button"
                title="Clear all saved preferences"
              >
                Clear All
              </button>
            </div>
          </div>

          <div id="prefs-list-container">
            <table id="prefs-table">
              <thead>
                <tr>
                  <th>Subreddit</th>
                  <th>Sort Order</th>
                  <th>Time Filter</th>
                  <th>Last Updated</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="prefs-tbody">
                <!-- Populated by JavaScript -->
              </tbody>
            </table>

            <p class="empty-state" id="prefs-empty">
              No saved preferences yet. Visit a subreddit and change the sort
              order to automatically save your preference.
            </p>
          </div>
        </div>
      </section>

      <!-- User Tags -->
      <section class="setting">
        <h2>User Tags</h2>
        <p class="section-description">
          Add custom labels and colors to Reddit users. Tags appear as badges
          next to usernames throughout Reddit.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="user-tags-enabled" checked />
            <span>Enable user tagging</span>
          </label>
          <p class="option-description">
            Click the tag button (üè∑Ô∏è) next to any username on Reddit to add a
            custom tag
          </p>
        </div>

        <div class="user-tags-management" id="user-tags-container">
          <div class="tags-header">
            <h3>
              Saved Tags
              <span class="tag-count"
                >(<span id="tag-count">0</span>/<span id="tag-max">500</span
                >)</span
              >
            </h3>
            <div class="tags-controls">
              <input
                type="text"
                id="tag-search"
                placeholder="Search users..."
                class="search-input"
              />
              <button
                id="export-tags"
                class="secondary-button"
                title="Export tags as JSON"
              >
                Export
              </button>
              <button
                id="import-tags"
                class="secondary-button"
                title="Import tags from JSON"
              >
                Import
              </button>
              <button
                id="clear-all-tags"
                class="danger-button"
                title="Clear all saved tags"
              >
                Clear All
              </button>
            </div>
          </div>

          <div id="tags-list-container">
            <table id="tags-table">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Tag</th>
                  <th>Color</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tags-tbody">
                <!-- Populated by JavaScript -->
              </tbody>
            </table>

            <p class="empty-state" id="tags-empty">
              No tags yet. Visit Reddit and click the tag button (üè∑Ô∏è) next to
              any username to add a tag.
            </p>
          </div>
        </div>
      </section>

      <!-- Scroll Position Memory -->
      <section class="setting">
        <h2>Scroll Position Memory</h2>
        <p class="section-description">
          Remember your scroll position when navigating away from pages. Your
          position is automatically restored when you return via the back
          button.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="scroll-positions-enabled" checked />
            <span>Remember scroll positions</span>
          </label>
          <p class="option-description">
            Automatically save and restore scroll position when using back
            button
          </p>
        </div>

        <div class="scroll-positions-management">
          <p class="info-text">
            <strong>Storage:</strong>
            <span id="scroll-positions-count">0</span> positions saved (max 100,
            auto-cleanup after 24 hours)
          </p>
          <button id="clear-scroll-positions" class="secondary-button">
            Clear All Positions
          </button>
        </div>
      </section>

      <!-- Nag Blocking -->
      <section class="setting">
        <h2>Nag & Banner Blocking</h2>
        <p class="section-description">
          Remove annoying popups, banners, and promotional content from old
          Reddit.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="nag-blocking-enabled" checked />
            <span>Enable nag blocking</span>
          </label>
          <p class="option-description">
            Master toggle for all nag/banner blocking features below
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="block-login-prompts" checked />
            <span>Block login prompts</span>
          </label>
          <p class="option-description">
            Hide popups and overlays asking you to log in
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="block-email-verification" checked />
            <span>Block email verification nags</span>
          </label>
          <p class="option-description">
            Remove banners asking you to verify your email address
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="block-premium-banners" checked />
            <span>Block Reddit Premium ads</span>
          </label>
          <p class="option-description">
            Hide promotional content for Reddit Premium/Gold
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="block-app-prompts" checked />
            <span>Block app download prompts</span>
          </label>
          <p class="option-description">
            Remove banners asking you to download the mobile app
          </p>
        </div>
      </section>

      <!-- Alternative Frontend -->
      <section class="setting">
        <h2>Reddit Frontend</h2>
        <p class="section-description">
          Choose which Reddit frontend to redirect to. Alternative frontends
          offer privacy benefits and work without JavaScript.
        </p>

        <div class="frontend-options" id="frontend-options">
          <!-- Populated by JS -->
        </div>

        <div class="custom-domain-section" id="custom-domain-section" hidden>
          <label for="custom-domain">Custom Domain</label>
          <div class="input-row">
            <input
              type="text"
              id="custom-domain"
              class="text-input"
              placeholder="example.com"
            />
            <button class="button" id="save-custom-domain">Save</button>
          </div>
          <p class="help-text">Enter domain without https:// prefix</p>
        </div>

        <div class="permission-notice" id="permission-notice" hidden>
          <span class="notice-icon">‚ö†Ô∏è</span>
          <span>This frontend requires additional permissions.</span>
          <button class="button" id="request-permission">
            Grant Permission
          </button>
        </div>
      </section>

      <!-- Subreddit Exceptions -->
      <section class="setting">
        <h2>Subreddit Exceptions</h2>
        <p class="section-description">
          These subreddits will stay on new Reddit instead of redirecting.
          Useful for subreddits that use new Reddit features (polls,
          predictions, etc.)
        </p>

        <div class="whitelist-container">
          <div class="whitelist-input-row">
            <span class="input-prefix">r/</span>
            <input
              type="text"
              id="subreddit-input"
              class="text-input"
              placeholder="subreddit name"
              pattern="^[A-Za-z0-9_]+$"
            />
            <button class="button" id="add-subreddit">Add</button>
          </div>

          <ul id="whitelist" class="tag-list">
            <!-- Populated by JS -->
          </ul>

          <p class="empty-state" id="whitelist-empty">
            No exceptions configured. All subreddits redirect to old Reddit.
          </p>
        </div>

        <div class="suggestions-container">
          <h3>Suggested Exceptions</h3>
          <p class="help-text">
            Popular subreddits that use new Reddit features like polls and
            predictions:
          </p>
          <div id="suggestions-list" class="suggestions-list">
            <!-- Populated by JS -->
          </div>
          <p class="empty-state" id="suggestions-empty" hidden>
            All suggestions have been added!
          </p>
        </div>
      </section>

      <!-- Muted Subreddits -->
      <section class="setting">
        <h2>Muted Subreddits</h2>
        <p class="section-description">
          Hide posts from these subreddits on /r/all and /r/popular. Useful for
          filtering out noise or unwanted content.
        </p>

        <div class="whitelist-container">
          <div class="whitelist-input-row">
            <span class="input-prefix">r/</span>
            <input
              type="text"
              id="muted-subreddit-input"
              class="text-input"
              placeholder="subreddit name"
              pattern="^[A-Za-z0-9_]+$"
            />
            <button class="button" id="add-muted-subreddit">Mute</button>
          </div>

          <ul id="muted-list" class="tag-list">
            <!-- Populated by JS -->
          </ul>

          <p class="empty-state" id="muted-empty">
            No muted subreddits. Posts from all subreddits will appear on /r/all
            and /r/popular.
          </p>
        </div>

        <div class="muted-actions">
          <button class="button secondary" id="export-muted">
            üì• Export List
          </button>
          <button class="button secondary" id="import-muted">
            üì§ Import List
          </button>
          <input
            type="file"
            id="import-muted-file"
            accept=".json"
            style="display: none"
          />
        </div>
      </section>

      <!-- Muted Keywords -->
      <section class="setting">
        <h2>Muted Keywords</h2>
        <p class="section-description">
          Hide posts containing specific words or phrases in their titles.
          Useful for filtering clickbait, spoilers, or topics you want to avoid.
        </p>

        <div class="whitelist-container">
          <div class="whitelist-input-row">
            <input
              type="text"
              id="keyword-input"
              class="text-input"
              placeholder="word or phrase"
            />
            <button class="button" id="add-keyword">Mute</button>
          </div>

          <div class="option-row" style="margin-top: 8px">
            <label class="checkbox-label">
              <input type="checkbox" id="case-sensitive" />
              <span>Case sensitive matching</span>
            </label>
          </div>

          <ul id="keyword-list" class="tag-list">
            <!-- Populated by JS -->
          </ul>

          <p class="empty-state" id="keyword-empty">
            No muted keywords. All post titles will be shown.
          </p>
        </div>

        <div class="muted-actions">
          <button class="button secondary" id="export-keywords">
            üì• Export List
          </button>
          <button class="button secondary" id="import-keywords">
            üì§ Import List
          </button>
          <input
            type="file"
            id="import-keywords-file"
            accept=".json"
            style="display: none"
          />
        </div>
      </section>

      <!-- Muted Domains -->
      <section class="setting">
        <h2>Muted Domains</h2>
        <p class="section-description">
          Hide posts linking to specific domains. Useful for filtering clickbait
          sites or content from sources you want to avoid. Supports wildcard
          subdomains (e.g., *.example.com).
        </p>

        <div class="whitelist-container">
          <div class="whitelist-input-row">
            <input
              type="text"
              id="domain-input"
              class="text-input"
              placeholder="example.com or *.example.com"
            />
            <button class="button" id="add-domain">Mute</button>
          </div>

          <ul id="domain-list" class="tag-list">
            <!-- Populated by JS -->
          </ul>

          <p class="empty-state" id="domain-empty">
            No muted domains. All post domains will be shown.
          </p>
        </div>

        <div class="muted-actions">
          <button class="button secondary" id="export-domains">
            üì• Export List
          </button>
          <button class="button secondary" id="import-domains">
            üì§ Import List
          </button>
          <input
            type="file"
            id="import-domains-file"
            accept=".json"
            style="display: none"
          />
        </div>
      </section>

      <!-- URL Testing Tool -->
      <section class="setting">
        <h2>Test a URL</h2>
        <p class="section-description">
          Check if a URL would be redirected before visiting it.
        </p>

        <div class="url-test-container">
          <div class="input-row">
            <input
              type="url"
              id="test-url-input"
              class="text-input"
              placeholder="https://reddit.com/r/news"
            />
            <button class="button" id="test-url-btn">Test</button>
          </div>

          <div class="test-result" id="test-result" hidden>
            <div class="result-icon" id="result-icon"></div>
            <div class="result-text">
              <p id="result-message"></p>
              <p class="result-detail" id="result-detail"></p>
            </div>
          </div>
        </div>
      </section>

      <!-- Keyboard Shortcut -->
      <section class="setting">
        <div class="setting-row">
          <div class="setting-info">
            <label>Keyboard Shortcut</label>
            <p class="description">
              Toggle redirect on/off with
              <kbd id="shortcut-display">Alt+Shift+R</kbd>
            </p>
          </div>
          <a href="#" id="customize-shortcut" class="button">Customize</a>
        </div>
      </section>

      <!-- Backup & Restore -->
      <section class="setting">
        <h2>Backup & Restore</h2>

        <div class="backup-actions">
          <button class="button" id="export-settings">
            üì§ Export Settings
          </button>
          <button class="button secondary" id="import-settings">
            üì• Import Settings
          </button>
        </div>

        <input
          type="file"
          id="import-file"
          accept=".json,application/json"
          hidden
        />

        <p class="help-text">
          Export your settings to a JSON file. Import to restore or share
          configurations. Statistics are not included in exports.
        </p>
      </section>

      <!-- Sync Settings -->
      <section class="setting">
        <h2>Sync Settings</h2>
        <div class="setting-row">
          <div class="setting-info">
            <label for="sync-toggle">Sync across browsers</label>
            <p class="description">
              Sync your preferences across Chrome/Edge browsers signed into the
              same account. Statistics are never synced.
            </p>
          </div>
          <label class="switch">
            <input type="checkbox" id="sync-toggle" />
            <span class="slider"></span>
          </label>
        </div>
        <p class="sync-status" id="sync-status">
          <!-- "Last synced: 2 minutes ago" or "Not synced" -->
        </p>
      </section>

      <!-- Footer -->
      <footer>
        <p>
          <a
            href="https://github.com/tom-james-watson/old-reddit-redirect"
            target="_blank"
            >View on GitHub</a
          >
          &bull;
          <a
            href="https://github.com/tom-james-watson/old-reddit-redirect/blob/master/PRIVACY.md"
            target="_blank"
            >Privacy Policy</a
          >
        </p>
      </footer>

      <!-- Toast notification -->
      <div id="toast" class="toast" hidden>
        <span id="toast-message"></span>
      </div>
    </div>
    <script src="logger.js"></script>
    <script src="storage.js"></script>
    <script src="suggestions.js"></script>
    <script src="frontends.js"></script>
    <script src="options.js"></script>
  </body>
</html>
