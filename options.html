<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Old Reddit Redirect - Options</title>
    <link rel="stylesheet" href="options.css" />
  </head>
  <body>
    <div class="container">
      <h1>Old Reddit Redirect</h1>

      <!-- Main Toggle -->
      <section
        class="setting"
        role="region"
        aria-labelledby="main-toggle-heading"
      >
        <h2 id="main-toggle-heading" class="visually-hidden">Main Toggle</h2>
        <div class="setting-row">
          <div class="setting-info">
            <label for="toggle-redirect">Enable Redirect</label>
            <p class="description" id="toggle-redirect-desc">
              Automatically redirect Reddit URLs to old.reddit.com
            </p>
          </div>
          <label class="switch" aria-label="Toggle redirect">
            <input
              type="checkbox"
              id="toggle-redirect"
              checked
              aria-describedby="toggle-redirect-desc"
            />
            <span class="slider" aria-hidden="true"></span>
          </label>
        </div>
      </section>

      <!-- Statistics -->
      <section class="setting" role="region" aria-labelledby="stats-heading">
        <h2 id="stats-heading">Statistics</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-number" id="total-redirects">0</span>
            <span class="stat-label">Total Redirects</span>
          </div>
          <div class="stat-card">
            <span class="stat-number" id="today-redirects">0</span>
            <span class="stat-label">Today</span>
          </div>
        </div>

        <!-- Weekly Trend Chart -->
        <div class="chart-container">
          <h3>Last 7 Days</h3>
          <div class="bar-chart" id="weekly-chart">
            <!-- Populated by JS -->
          </div>
        </div>

        <div class="stats-detail">
          <h3>Top Subreddits</h3>
          <ol id="top-subreddits" class="subreddit-list">
            <!-- Populated by JS -->
          </ol>
          <p class="empty-state" id="subreddit-empty">
            No subreddit data yet. Visit some subreddits to see stats!
          </p>
        </div>
        <div class="stats-actions">
          <button class="button secondary" id="export-stats">
            üìä Export Stats
          </button>
          <button class="button secondary" id="clear-stats">
            Clear Statistics
          </button>
        </div>
      </section>

      <!-- Visual Preferences -->
      <section
        class="setting"
        role="region"
        aria-labelledby="visual-prefs-heading"
      >
        <h2 id="visual-prefs-heading">Visual Preferences</h2>

        <div class="option-row">
          <label for="icon-click-behavior">Icon Click Behavior</label>
          <select id="icon-click-behavior" class="select-input">
            <option value="popup">Open popup (default)</option>
            <option value="toggle">Toggle redirect on/off</option>
          </select>
          <p class="option-description">
            Choose what happens when you click the extension icon. Keyboard
            shortcut always toggles regardless of this setting.
          </p>
        </div>

        <div class="option-row">
          <label for="badge-style">Badge Style</label>
          <select id="badge-style" class="select-input">
            <option value="text">Text ("OFF" when disabled)</option>
            <option value="count">Redirect count</option>
            <option value="color">Color only</option>
          </select>
          <p class="option-description">
            How the extension icon badge should display
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="animate-toggle" checked />
            <span>Animate icon on toggle</span>
          </label>
          <p class="option-description">
            Flash the badge color when toggling redirect on/off
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="show-notifications" />
            <span>Show notifications</span>
          </label>
          <p class="option-description">
            Show browser notifications for redirect events
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="show-redirect-notice" />
            <span>Show redirect notice</span>
          </label>
          <p class="option-description">
            Show a small notification on old.reddit.com after redirect with "Go
            back" option
          </p>
        </div>
      </section>

      <!-- Dark Mode -->
      <section
        class="setting"
        role="region"
        aria-labelledby="dark-mode-heading"
      >
        <h2 id="dark-mode-heading">Dark Mode for old.reddit.com</h2>
        <p class="section-description">
          Apply a dark theme to old Reddit that respects your system
          preferences.
        </p>

        <div class="option-row">
          <label for="dark-mode">Dark Mode</label>
          <select
            id="dark-mode"
            class="select-input"
            aria-describedby="dark-mode-desc"
          >
            <option value="auto">Auto (follow system preference)</option>
            <option value="light">Light</option>
            <option value="dark">Dark</option>
            <option value="oled">OLED Black</option>
            <option value="high-contrast">High Contrast (Accessibility)</option>
          </select>
          <p class="option-description" id="dark-mode-desc">
            Choose when to apply dark mode. "Auto" follows your system's
            light/dark preference. "OLED Black" uses pure black for OLED
            screens. "High Contrast" provides maximum visibility for users with
            visual impairments.
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="auto-collapse-automod" checked />
            <span>Auto-collapse bot comments</span>
          </label>
          <p class="option-description">
            Automatically collapse AutoModerator and common bot comments when
            loading comment threads
          </p>
        </div>
      </section>

      <!-- Accessibility -->
      <section class="setting" aria-labelledby="accessibility-heading">
        <h2 id="accessibility-heading">Accessibility</h2>
        <p class="section-description">
          Customize the extension for better accessibility. These settings help
          users with visual impairments or motor disabilities.
        </p>

        <div class="option-row">
          <label for="font-size">Content Font Size</label>
          <select
            id="font-size"
            class="select-input"
            aria-describedby="font-size-desc"
          >
            <option value="small">Small (87.5%)</option>
            <option value="medium">Medium (Default)</option>
            <option value="large">Large (112.5%)</option>
            <option value="x-large">Extra Large (125%)</option>
          </select>
          <p class="option-description" id="font-size-desc">
            Adjust the font size of Reddit content. Affects post titles,
            comments, and other text on old.reddit.com.
          </p>
        </div>

        <div class="option-row">
          <label for="reduce-motion">Reduce Motion</label>
          <select
            id="reduce-motion"
            class="select-input"
            aria-describedby="reduce-motion-desc"
          >
            <option value="auto">Auto (follow system preference)</option>
            <option value="always">Always reduce motion</option>
            <option value="never">Never reduce motion</option>
          </select>
          <p class="option-description" id="reduce-motion-desc">
            Control animations and transitions. "Auto" respects your system's
            reduced motion setting. Helpful for users with vestibular disorders.
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input
              type="checkbox"
              id="high-contrast-elements"
              aria-describedby="high-contrast-desc"
            />
            <span>High contrast UI elements</span>
          </label>
          <p class="option-description" id="high-contrast-desc">
            Add extra-visible borders and outlines to buttons, inputs, and other
            interactive elements. Works alongside any theme.
          </p>
        </div>
      </section>

      <!-- Comment Enhancements -->
      <section class="setting" aria-labelledby="comment-heading">
        <h2 id="comment-heading">Comment Enhancements</h2>
        <p class="section-description">
          Improve the comment reading experience with visual enhancements.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="color-coded-comments" checked />
            <span>Color-coded comment depth</span>
          </label>
          <p class="option-description">
            Add colored stripes to the left edge of comments indicating nesting
            depth. Helps visually track conversation threads.
          </p>
        </div>

        <div class="option-row">
          <label for="color-palette">Color Palette</label>
          <select id="color-palette" class="select-input">
            <option value="standard">Standard (Rainbow)</option>
            <option value="colorblind">Color-Blind Friendly</option>
          </select>
          <p class="option-description">
            Choose color palette for comment depth indicators. Color-blind
            palette uses distinct hues optimized for accessibility.
          </p>
        </div>

        <div class="option-row">
          <label for="stripe-width">Stripe Width</label>
          <select id="stripe-width" class="select-input">
            <option value="2">Thin (2px)</option>
            <option value="3">Medium (3px)</option>
            <option value="4">Thick (4px)</option>
            <option value="5">Extra Thick (5px)</option>
          </select>
          <p class="option-description">
            Width of the colored stripe on the left edge of comments.
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="navigation-buttons" checked />
            <span>Comment navigation buttons</span>
          </label>
          <p class="option-description">
            Show floating buttons to jump between top-level comments. Use
            Shift+J/K for keyboard navigation.
          </p>
        </div>

        <div class="option-row">
          <label for="nav-button-position">Button Position</label>
          <select id="nav-button-position" class="select-input">
            <option value="bottom-right">Bottom Right</option>
            <option value="bottom-left">Bottom Left</option>
          </select>
          <p class="option-description">
            Choose where the navigation buttons appear on the screen.
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="inline-images" checked />
            <span>Inline image expansion</span>
          </label>
          <p class="option-description">
            Add expand buttons next to image links in comments. Click to view
            images inline without opening a new tab.
          </p>
        </div>

        <div class="option-row">
          <label for="max-image-width">Maximum Image Width</label>
          <select id="max-image-width" class="select-input">
            <option value="400">Small (400px)</option>
            <option value="600">Medium (600px)</option>
            <option value="800">Large (800px)</option>
            <option value="0">Full Width</option>
          </select>
          <p class="option-description">
            Maximum width for expanded images. "Full Width" uses the comment
            area width.
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="jump-to-top-shortcut" checked />
            <span>Jump to top keyboard shortcut (Shift+Home)</span>
          </label>
          <p class="option-description">
            Press Shift+Home to smoothly scroll to the top of any page. Respects
            reduced motion preferences.
          </p>
        </div>
      </section>

      <!-- Comment Minimap -->
      <section class="setting" role="region" aria-labelledby="minimap-heading">
        <h2 id="minimap-heading">Comment Thread Minimap</h2>
        <p class="section-description">
          A visual navigation aid that shows an overview of the comment thread.
          Click on the minimap to quickly jump to any comment.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="minimap-enabled" checked />
            <span>Enable comment minimap</span>
          </label>
          <p class="option-description">
            Show a minimap on comment pages for easy thread navigation.
          </p>
        </div>

        <div class="option-row" id="minimap-position-row">
          <label for="minimap-position">Minimap Position</label>
          <select
            id="minimap-position"
            class="select-input"
            aria-describedby="minimap-position-desc"
          >
            <option value="right">Right side</option>
            <option value="left">Left side</option>
          </select>
          <p class="option-description" id="minimap-position-desc">
            Choose which side of the screen to display the minimap.
          </p>
        </div>

        <div class="option-row" id="minimap-width-row">
          <label for="minimap-width">Minimap Width</label>
          <div class="range-container">
            <input
              type="range"
              id="minimap-width"
              min="80"
              max="200"
              value="120"
              class="range-input"
            />
            <span id="minimap-width-value">120px</span>
          </div>
          <p class="help-text">Width of the minimap in pixels.</p>
        </div>

        <div class="option-row" id="minimap-opacity-row">
          <label for="minimap-opacity">Minimap Opacity</label>
          <div class="range-container">
            <input
              type="range"
              id="minimap-opacity"
              min="50"
              max="100"
              value="90"
              class="range-input"
            />
            <span id="minimap-opacity-value">90%</span>
          </div>
          <p class="help-text">Transparency of the minimap.</p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="minimap-viewport" checked />
            <span>Show viewport indicator</span>
          </label>
          <p class="option-description">
            Highlight the currently visible portion of the thread in the
            minimap.
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="minimap-depth-colors" checked />
            <span>Use depth colors</span>
          </label>
          <p class="option-description">
            Color-code minimap entries by comment depth (matches color-coded
            comments).
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="minimap-collapsed" checked />
            <span>Show collapsed indicator</span>
          </label>
          <p class="option-description">
            Visually distinguish collapsed comments in the minimap.
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="minimap-autohide" />
            <span>Auto-hide when not hovering</span>
          </label>
          <p class="option-description">
            Fade out the minimap when not in use to reduce visual clutter.
          </p>
        </div>
      </section>

      <!-- Sort Preferences -->
      <section class="setting">
        <h2>Subreddit Sort Preferences</h2>
        <p class="section-description">
          Automatically apply your preferred sort order (new, top, rising, etc.)
          when visiting subreddits. Your preference is saved when you manually
          change the sort order.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="sort-preferences-enabled" checked />
            <span>Remember sort order per subreddit</span>
          </label>
          <p class="option-description">
            Enable automatic sort order application when visiting subreddits
          </p>
        </div>

        <div class="sort-preferences-management" id="sort-prefs-container">
          <div class="prefs-header">
            <h3>
              Saved Preferences
              <span class="pref-count"
                >(<span id="pref-count">0</span>/<span id="pref-max">100</span
                >)</span
              >
            </h3>
            <div class="prefs-controls">
              <input
                type="text"
                id="pref-search"
                placeholder="Search subreddits..."
                class="search-input"
              />
              <button
                id="export-prefs"
                class="secondary-button"
                title="Export preferences as JSON"
              >
                Export
              </button>
              <button
                id="import-prefs"
                class="secondary-button"
                title="Import preferences from JSON"
              >
                Import
              </button>
              <button
                id="clear-all-prefs"
                class="danger-button"
                title="Clear all saved preferences"
              >
                Clear All
              </button>
            </div>
          </div>

          <div id="prefs-list-container">
            <table id="prefs-table">
              <thead>
                <tr>
                  <th>Subreddit</th>
                  <th>Sort Order</th>
                  <th>Time Filter</th>
                  <th>Last Updated</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="prefs-tbody">
                <!-- Populated by JavaScript -->
              </tbody>
            </table>

            <p class="empty-state" id="prefs-empty">
              No saved preferences yet. Visit a subreddit and change the sort
              order to automatically save your preference.
            </p>
          </div>
        </div>
      </section>

      <!-- User Tags -->
      <section class="setting">
        <h2>User Tags</h2>
        <p class="section-description">
          Add custom labels and colors to Reddit users. Tags appear as badges
          next to usernames throughout Reddit.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="user-tags-enabled" checked />
            <span>Enable user tagging</span>
          </label>
          <p class="option-description">
            Click the tag button (üè∑Ô∏è) next to any username on Reddit to add a
            custom tag
          </p>
        </div>

        <div class="user-tags-management" id="user-tags-container">
          <div class="tags-header">
            <h3>
              Saved Tags
              <span class="tag-count"
                >(<span id="tag-count">0</span>/<span id="tag-max">500</span
                >)</span
              >
            </h3>
            <div class="tags-controls">
              <input
                type="text"
                id="tag-search"
                placeholder="Search users..."
                class="search-input"
              />
              <button
                id="export-tags"
                class="secondary-button"
                title="Export tags as JSON"
              >
                Export
              </button>
              <button
                id="import-tags"
                class="secondary-button"
                title="Import tags from JSON"
              >
                Import
              </button>
              <button
                id="clear-all-tags"
                class="danger-button"
                title="Clear all saved tags"
              >
                Clear All
              </button>
            </div>
          </div>

          <div id="tags-list-container">
            <table id="tags-table">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Tag</th>
                  <th>Color</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tags-tbody">
                <!-- Populated by JavaScript -->
              </tbody>
            </table>

            <p class="empty-state" id="tags-empty">
              No tags yet. Visit Reddit and click the tag button (üè∑Ô∏è) next to
              any username to add a tag.
            </p>
          </div>
        </div>
      </section>

      <!-- Muted Users -->
      <section class="setting">
        <h2>User Muting</h2>
        <p class="section-description">
          Hide posts and comments from specific users. Muted users are
          completely hidden from your feed and comment threads.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="user-muting-enabled" checked />
            <span>Enable user muting</span>
          </label>
          <p class="option-description">
            Hide posts and comments from muted users. Right-click any username
            to mute them via context menu.
          </p>
        </div>

        <div class="muted-users-container">
          <div class="list-header">
            <h3>Muted Users (<span id="muted-users-count">0</span>/500)</h3>
            <div class="list-actions">
              <button class="button secondary" id="import-muted-users">
                Import
              </button>
              <button class="button secondary" id="export-muted-users">
                Export
              </button>
              <button class="button secondary" id="clear-muted-users">
                Clear All
              </button>
            </div>
          </div>

          <div class="add-user-form">
            <input
              type="text"
              id="new-muted-user"
              placeholder="Enter username (without u/)"
              class="text-input"
            />
            <input
              type="text"
              id="mute-reason"
              placeholder="Reason (optional)"
              class="text-input"
            />
            <button class="button" id="add-muted-user">Add</button>
          </div>

          <div id="muted-users-list" class="item-list">
            <!-- Populated by JS -->
          </div>
          <p class="empty-state" id="muted-users-empty">
            No muted users. Right-click any username to mute them or add one
            manually above.
          </p>
        </div>
      </section>

      <!-- Scroll Position Memory -->
      <section class="setting">
        <h2>Scroll Position Memory</h2>
        <p class="section-description">
          Remember your scroll position when navigating away from pages. Your
          position is automatically restored when you return via the back
          button.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="scroll-positions-enabled" checked />
            <span>Remember scroll positions</span>
          </label>
          <p class="option-description">
            Automatically save and restore scroll position when using back
            button
          </p>
        </div>

        <div class="scroll-positions-management">
          <p class="info-text">
            <strong>Storage:</strong>
            <span id="scroll-positions-count">0</span> positions saved (max 100,
            auto-cleanup after 24 hours)
          </p>
          <button id="clear-scroll-positions" class="secondary-button">
            Clear All Positions
          </button>
        </div>
      </section>

      <!-- Nag Blocking -->
      <section class="setting">
        <h2>Nag & Banner Blocking</h2>
        <p class="section-description">
          Remove annoying popups, banners, and promotional content from old
          Reddit.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="nag-blocking-enabled" checked />
            <span>Enable nag blocking</span>
          </label>
          <p class="option-description">
            Master toggle for all nag/banner blocking features below
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="block-login-prompts" checked />
            <span>Block login prompts</span>
          </label>
          <p class="option-description">
            Hide popups and overlays asking you to log in
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="block-email-verification" checked />
            <span>Block email verification nags</span>
          </label>
          <p class="option-description">
            Remove banners asking you to verify your email address
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="block-premium-banners" checked />
            <span>Block Reddit Premium ads</span>
          </label>
          <p class="option-description">
            Hide promotional content for Reddit Premium/Gold
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="block-app-prompts" checked />
            <span>Block app download prompts</span>
          </label>
          <p class="option-description">
            Remove banners asking you to download the mobile app
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="block-ai-content" checked />
            <span>Block AI-generated content</span>
          </label>
          <p class="option-description">
            Hide AI answers, summaries, and overviews. Future-proofed against
            Reddit's AI features.
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="block-trending" checked />
            <span>Block trending posts sections</span>
          </label>
          <p class="option-description">
            Remove trending subreddits and posts widgets
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="block-recommended" checked />
            <span>Block recommended communities</span>
          </label>
          <p class="option-description">
            Hide recommended subreddits and community suggestions
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="block-community-highlights" checked />
            <span>Block community highlights</span>
          </label>
          <p class="option-description">
            Remove featured posts and spotlight content
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="block-more-posts" checked />
            <span>Block "More posts you may like"</span>
          </label>
          <p class="option-description">
            Hide recommended posts and "continue browsing" sections
          </p>
        </div>
      </section>

      <!-- Feed Enhancements -->
      <section class="setting">
        <h2>Feed Enhancements</h2>
        <p class="section-description">
          Customize the appearance and layout of Reddit feeds for better
          readability and information density.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="feed-compact-mode" />
            <span>Compact mode</span>
          </label>
          <p class="option-description">
            Reduce spacing to show more posts per screen (~30% smaller posts)
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="feed-text-only" />
            <span>Text-only mode</span>
          </label>
          <p class="option-description">
            Hide all images and thumbnails for focused reading and bandwidth
            savings
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="feed-uncrop-images" />
            <span>Uncropped thumbnails</span>
          </label>
          <p class="option-description">
            Show full-aspect-ratio thumbnails instead of cropped squares
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="feed-hide-join" />
            <span>Hide join buttons</span>
          </label>
          <p class="option-description">
            Remove subreddit join/subscribe buttons from feed
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="feed-hide-actions" />
            <span>Hide action links</span>
          </label>
          <p class="option-description">
            Hide share/save/hide/report links until you hover over a post
            (comments link always visible)
          </p>
        </div>

        <div class="option-row custom-css-section">
          <h3>Custom CSS (Advanced)</h3>
          <p class="section-description warning">
            ‚ö†Ô∏è Advanced feature: Custom CSS can break page layout. Use at your
            own risk.
          </p>

          <label class="checkbox-label">
            <input type="checkbox" id="custom-css-enabled" />
            <span>Enable custom CSS</span>
          </label>

          <textarea
            id="custom-css"
            rows="10"
            placeholder="/* Your custom CSS here */&#10;.thing { ... }"
            spellcheck="false"
            class="custom-css-textarea"
          ></textarea>

          <div class="button-row">
            <button id="save-custom-css" class="primary-button">
              Save CSS
            </button>
            <button id="clear-custom-css" class="secondary-button">
              Clear
            </button>
            <button id="validate-custom-css" class="secondary-button">
              Validate
            </button>
          </div>
        </div>
      </section>

      <!-- Layout Presets -->
      <section class="setting">
        <h2>Layout Presets</h2>
        <p class="section-description">
          Save combinations of visual settings as presets for quick switching.
          Apply different layouts to specific subreddits automatically.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="layout-presets-enabled" checked />
            <span>Enable layout presets</span>
          </label>
          <p class="option-description">
            Save and apply custom layout configurations as reusable presets
          </p>
        </div>

        <div id="layout-presets-container">
          <!-- Create New Preset -->
          <div class="subsection">
            <h3>Create New Preset</h3>
            <div class="create-preset-form">
              <div class="form-row">
                <input
                  type="text"
                  id="new-preset-name"
                  class="text-input"
                  placeholder="Preset name (e.g., Night Mode, Compact Reading)"
                  maxlength="50"
                />
                <button class="button" id="create-preset-btn">
                  Create from Current
                </button>
              </div>
              <p class="help-text">
                Creates a preset from your current feed enhancement and dark
                mode settings.
              </p>
            </div>
          </div>

          <!-- Saved Presets -->
          <div class="subsection">
            <div class="presets-header">
              <h3>
                Saved Presets
                <span class="preset-count"
                  >(<span id="preset-count">0</span>/<span id="preset-max"
                    >20</span
                  >)</span
                >
              </h3>
              <div class="presets-controls">
                <button
                  id="export-presets"
                  class="secondary-button"
                  title="Export presets as JSON"
                >
                  Export
                </button>
                <button
                  id="import-presets"
                  class="secondary-button"
                  title="Import presets from JSON"
                >
                  Import
                </button>
                <button
                  id="clear-all-presets"
                  class="danger-button"
                  title="Clear all saved presets"
                >
                  Clear All
                </button>
              </div>
            </div>

            <div id="presets-list-container">
              <table id="presets-table" class="data-table">
                <thead>
                  <tr>
                    <th>Preset Name</th>
                    <th>Settings</th>
                    <th>Created</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="presets-tbody">
                  <!-- Populated by JavaScript -->
                </tbody>
              </table>

              <p class="empty-state" id="presets-empty">
                No presets saved yet. Create a preset from your current settings
                using the form above.
              </p>
            </div>
          </div>

          <!-- Active Preset -->
          <div class="subsection">
            <h3>Active Preset</h3>
            <div class="active-preset-row">
              <select id="active-preset-select" class="select-input">
                <option value="">None (use individual settings)</option>
                <!-- Populated by JavaScript -->
              </select>
              <p class="help-text">
                The active preset is applied globally. Subreddit-specific
                layouts override this.
              </p>
            </div>
          </div>

          <!-- Subreddit Layouts -->
          <div class="subsection">
            <div class="subreddit-layouts-header">
              <h3>
                Subreddit-Specific Layouts
                <span class="mapping-count"
                  >(<span id="mapping-count">0</span>/<span id="mapping-max"
                    >100</span
                  >)</span
                >
              </h3>
            </div>

            <div class="add-mapping-form">
              <div class="form-row">
                <span class="input-prefix">r/</span>
                <input
                  type="text"
                  id="mapping-subreddit"
                  class="text-input"
                  placeholder="subreddit name"
                />
                <select id="mapping-preset" class="select-input">
                  <option value="">Select preset...</option>
                  <!-- Populated by JavaScript -->
                </select>
                <button class="button" id="add-mapping-btn">Add</button>
              </div>
              <p class="help-text">
                Apply a specific layout preset when visiting a subreddit.
              </p>
            </div>

            <div id="mappings-list-container">
              <table id="mappings-table" class="data-table">
                <thead>
                  <tr>
                    <th>Subreddit</th>
                    <th>Preset</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="mappings-tbody">
                  <!-- Populated by JavaScript -->
                </tbody>
              </table>

              <p class="empty-state" id="mappings-empty">
                No subreddit layouts configured. Add a mapping above to apply
                different presets to specific subreddits.
              </p>
            </div>

            <div class="mapping-actions">
              <button
                id="clear-all-mappings"
                class="secondary-button"
                title="Clear all subreddit mappings"
              >
                Clear All Mappings
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Preset Edit Modal -->
      <div id="preset-edit-modal" class="modal" style="display: none">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Edit Preset</h3>
            <button class="modal-close" id="preset-edit-close">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="preset-edit-name">Preset Name</label>
              <input
                type="text"
                id="preset-edit-name"
                class="text-input"
                maxlength="50"
              />
            </div>

            <h4>Visual Settings</h4>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="preset-dark-mode" />
                Dark mode enabled
              </label>
            </div>

            <div class="form-group">
              <label for="preset-dark-mode-type">Dark Mode Type</label>
              <select id="preset-dark-mode-type" class="select-input">
                <option value="dark">Dark</option>
                <option value="oled">OLED Black</option>
              </select>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="preset-compact-mode" />
                Compact mode
              </label>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="preset-text-only" />
                Text-only mode
              </label>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="preset-uncrop-images" />
                Uncropped thumbnails
              </label>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="preset-hide-join" />
                Hide join buttons
              </label>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="preset-hide-actions" />
                Hide action links
              </label>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="preset-color-comments" />
                Color-coded comments
              </label>
            </div>

            <div class="form-group">
              <label for="preset-color-palette">Comment Color Palette</label>
              <select id="preset-color-palette" class="select-input">
                <option value="standard">Standard (Rainbow)</option>
                <option value="colorblind">Color-Blind Friendly</option>
              </select>
            </div>

            <div class="form-group">
              <label for="preset-custom-css">Custom CSS (optional)</label>
              <textarea
                id="preset-custom-css"
                rows="5"
                class="custom-css-textarea"
                placeholder="/* Custom CSS for this preset */"
              ></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button id="preset-edit-save" class="primary-button">Save</button>
            <button id="preset-edit-cancel" class="secondary-button">
              Cancel
            </button>
          </div>
        </div>
      </div>

      <!-- Privacy & Tracking Protection -->
      <section class="setting">
        <h2>Privacy & Tracking Protection</h2>
        <p class="section-description">
          Protect your privacy by removing tracking parameters from URLs and
          controlling referrer information sent when leaving Reddit.
        </p>

        <!-- Privacy Score -->
        <div class="privacy-score-container">
          <div class="privacy-score-circle">
            <svg viewBox="0 0 36 36" class="privacy-score-ring">
              <path
                class="privacy-score-bg"
                d="M18 2.0845
                  a 15.9155 15.9155 0 0 1 0 31.831
                  a 15.9155 15.9155 0 0 1 0 -31.831"
              />
              <path
                class="privacy-score-fill"
                id="privacy-score-fill"
                stroke-dasharray="0, 100"
                d="M18 2.0845
                  a 15.9155 15.9155 0 0 1 0 31.831
                  a 15.9155 15.9155 0 0 1 0 -31.831"
              />
            </svg>
            <div class="privacy-score-value" id="privacy-score-value">0</div>
          </div>
          <div class="privacy-score-info">
            <div class="privacy-score-label">Privacy Score</div>
            <div class="privacy-score-status" id="privacy-score-status">
              Calculating...
            </div>
            <div
              class="privacy-recommendations"
              id="privacy-recommendations"
            ></div>
          </div>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="tracking-removal-enabled" />
            <span>Remove tracking parameters from URLs</span>
          </label>
          <p class="help-text">
            Automatically strips tracking parameters like utm_source, fbclid,
            gclid, and 55+ others when you click links.
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="tracking-badge-enabled" />
            <span>Show shield badge when tracking is removed</span>
          </label>
          <p class="help-text">
            Display a temporary üõ°Ô∏è badge in the extension icon when tracking
            parameters are cleaned (lasts 3 seconds).
          </p>
        </div>

        <div class="subsection">
          <h3>Tracking Statistics by Category</h3>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-label">Total URLs Cleaned</div>
              <div class="stat-value" id="tracking-total-cleaned">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Last Cleaned</div>
              <div
                class="stat-value stat-value-small"
                id="tracking-last-cleaned"
              >
                Never
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-label">UTM Parameters</div>
              <div class="stat-value" id="tracking-utm-count">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Social Media</div>
              <div class="stat-value" id="tracking-social-count">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Analytics</div>
              <div class="stat-value" id="tracking-analytics-count">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Affiliate/Referral</div>
              <div class="stat-value" id="tracking-affiliate-count">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Reddit-Specific</div>
              <div class="stat-value" id="tracking-reddit-count">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Other Trackers</div>
              <div class="stat-value" id="tracking-other-count">0</div>
            </div>
          </div>
        </div>

        <div class="button-row" style="margin-top: 15px">
          <button id="clear-tracking-stats" class="secondary-button">
            Clear Statistics
          </button>
          <button id="export-privacy-report" class="secondary-button">
            Export Privacy Report
          </button>
        </div>

        <div class="subsection">
          <h3>Referrer Control</h3>
          <p class="help-text" style="margin-bottom: 10px">
            Choose what referrer information is sent when you leave Reddit.
            Higher privacy may break some website features.
          </p>

          <label class="radio-label">
            <input
              type="radio"
              name="referrer-policy"
              value="default"
              id="referrer-default"
            />
            <span>
              <strong>Default</strong> - Use browser's default behavior
            </span>
          </label>

          <label class="radio-label">
            <input
              type="radio"
              name="referrer-policy"
              value="same-origin"
              id="referrer-same-origin"
            />
            <span>
              <strong>Same Origin (Recommended)</strong> - Only send referrer
              within Reddit
            </span>
          </label>

          <label class="radio-label">
            <input
              type="radio"
              name="referrer-policy"
              value="origin"
              id="referrer-origin"
            />
            <span>
              <strong>Origin Only</strong> - Only send domain (high privacy)
            </span>
          </label>

          <label class="radio-label">
            <input
              type="radio"
              name="referrer-policy"
              value="no-referrer"
              id="referrer-no-referrer"
            />
            <span>
              <strong>No Referrer</strong> - Don't send any referrer (maximum
              privacy)
            </span>
          </label>
        </div>

        <div class="subsection">
          <h3>Custom Tracking Parameters</h3>
          <p class="help-text">
            Add or remove tracking parameters (one per line). Changes take
            effect immediately.
          </p>

          <textarea
            id="tracking-params"
            rows="8"
            placeholder="utm_source&#10;fbclid&#10;gclid&#10;..."
            spellcheck="false"
            class="custom-css-textarea"
          ></textarea>

          <div class="button-row">
            <button id="save-tracking-params" class="primary-button">
              Save Parameters
            </button>
            <button id="reset-tracking-params" class="secondary-button">
              Reset to Defaults
            </button>
          </div>
        </div>
      </section>

      <!-- Alternative Frontend -->
      <section class="setting">
        <h2>Reddit Frontend</h2>
        <p class="section-description">
          Choose which Reddit frontend to redirect to. Alternative frontends
          offer privacy benefits and work without JavaScript.
        </p>

        <div class="frontend-options" id="frontend-options">
          <!-- Populated by JS -->
        </div>

        <div class="custom-domain-section" id="custom-domain-section" hidden>
          <label for="custom-domain">Custom Domain</label>
          <div class="input-row">
            <input
              type="text"
              id="custom-domain"
              class="text-input"
              placeholder="example.com"
            />
            <button class="button" id="save-custom-domain">Save</button>
          </div>
          <p class="help-text">Enter domain without https:// prefix</p>
        </div>

        <div class="permission-notice" id="permission-notice" hidden>
          <span class="notice-icon">‚ö†Ô∏è</span>
          <span>This frontend requires additional permissions.</span>
          <button class="button" id="request-permission">
            Grant Permission
          </button>
        </div>
      </section>

      <!-- Subreddit Exceptions -->
      <section class="setting">
        <h2>Subreddit Exceptions</h2>
        <p class="section-description">
          These subreddits will stay on new Reddit instead of redirecting.
          Useful for subreddits that use new Reddit features (polls,
          predictions, etc.)
        </p>

        <div class="whitelist-container">
          <div class="whitelist-input-row">
            <span class="input-prefix">r/</span>
            <input
              type="text"
              id="subreddit-input"
              class="text-input"
              placeholder="subreddit name"
              pattern="^[A-Za-z0-9_]+$"
            />
            <button class="button" id="add-subreddit">Add</button>
          </div>

          <ul id="whitelist" class="tag-list">
            <!-- Populated by JS -->
          </ul>

          <p class="empty-state" id="whitelist-empty">
            No exceptions configured. All subreddits redirect to old Reddit.
          </p>
        </div>

        <div class="suggestions-container">
          <h3>Suggested Exceptions</h3>
          <p class="help-text">
            Popular subreddits that use new Reddit features like polls and
            predictions:
          </p>
          <div id="suggestions-list" class="suggestions-list">
            <!-- Populated by JS -->
          </div>
          <p class="empty-state" id="suggestions-empty" hidden>
            All suggestions have been added!
          </p>
        </div>
      </section>

      <!-- Muted Subreddits -->
      <section class="setting">
        <h2>Muted Subreddits</h2>
        <p class="section-description">
          Hide posts from these subreddits on /r/all and /r/popular. Useful for
          filtering out noise or unwanted content.
        </p>

        <div class="whitelist-container">
          <div class="whitelist-input-row">
            <span class="input-prefix">r/</span>
            <input
              type="text"
              id="muted-subreddit-input"
              class="text-input"
              placeholder="subreddit name"
              pattern="^[A-Za-z0-9_]+$"
            />
            <button class="button" id="add-muted-subreddit">Mute</button>
          </div>

          <ul id="muted-list" class="tag-list">
            <!-- Populated by JS -->
          </ul>

          <p class="empty-state" id="muted-empty">
            No muted subreddits. Posts from all subreddits will appear on /r/all
            and /r/popular.
          </p>
        </div>

        <div class="muted-actions">
          <button class="button secondary" id="export-muted">
            üì• Export List
          </button>
          <button class="button secondary" id="import-muted">
            üì§ Import List
          </button>
          <input
            type="file"
            id="import-muted-file"
            accept=".json"
            style="display: none"
          />
        </div>
      </section>

      <!-- Muted Keywords -->
      <section class="setting">
        <h2>Muted Keywords</h2>
        <p class="section-description">
          Hide posts containing specific words or phrases in their titles.
          Useful for filtering clickbait, spoilers, or topics you want to avoid.
        </p>

        <div class="whitelist-container">
          <div class="whitelist-input-row">
            <input
              type="text"
              id="keyword-input"
              class="text-input"
              placeholder="word or phrase"
            />
            <button class="button" id="add-keyword">Mute</button>
          </div>

          <div class="option-row" style="margin-top: 8px">
            <label class="checkbox-label">
              <input type="checkbox" id="case-sensitive" />
              <span>Case sensitive matching</span>
            </label>
          </div>

          <div class="option-row">
            <label class="checkbox-label">
              <input type="checkbox" id="use-regex" />
              <span>Use regular expressions (advanced)</span>
            </label>
            <p class="option-description">
              Treat keywords as regex patterns instead of plain text. Requires
              valid regex syntax.
            </p>
          </div>

          <div class="option-row">
            <label class="checkbox-label">
              <input type="checkbox" id="filter-content" />
              <span>Filter post content (not just titles)</span>
            </label>
            <p class="option-description">
              Check post body text for keywords, not just titles. Works with
              self-posts that have visible content.
            </p>
          </div>

          <ul id="keyword-list" class="tag-list">
            <!-- Populated by JS -->
          </ul>

          <p class="empty-state" id="keyword-empty">
            No muted keywords. All post titles will be shown.
          </p>
        </div>

        <div class="muted-actions">
          <button class="button secondary" id="export-keywords">
            üì• Export List
          </button>
          <button class="button secondary" id="import-keywords">
            üì§ Import List
          </button>
          <input
            type="file"
            id="import-keywords-file"
            accept=".json"
            style="display: none"
          />
        </div>
      </section>

      <!-- Flair Filtering -->
      <section class="setting">
        <h2>Flair Filtering</h2>
        <p class="section-description">
          Hide posts with specific post flairs. Many subreddits use flairs to
          categorize posts (e.g., "Meme", "Discussion", "NSFW").
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="filter-by-flair" />
            <span>Enable flair filtering</span>
          </label>
          <p class="option-description">
            Hide posts based on their flair text. Flair text must match exactly
            (case-insensitive).
          </p>
        </div>

        <div class="whitelist-container">
          <div class="whitelist-input-row">
            <input
              type="text"
              id="flair-input"
              class="text-input"
              placeholder="Flair text (e.g., Meme, Spoiler)"
            />
            <button class="button" id="add-flair">Mute</button>
          </div>

          <ul id="flair-list" class="tag-list">
            <!-- Populated by JS -->
          </ul>

          <p class="empty-state" id="flair-empty">
            No muted flairs. All posts regardless of flair will be shown.
          </p>
        </div>

        <div class="muted-actions">
          <button class="button secondary" id="export-flairs">
            üì• Export List
          </button>
          <button class="button secondary" id="import-flairs">
            üì§ Import List
          </button>
        </div>
      </section>

      <!-- Score Filtering -->
      <section class="setting">
        <h2>Score Filtering</h2>
        <p class="section-description">
          Hide posts with scores below a threshold. Useful for filtering low
          quality or unpopular content.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="filter-by-score" />
            <span>Enable score filtering</span>
          </label>
          <p class="option-description">
            Hide posts with scores below the minimum threshold.
          </p>
        </div>

        <div class="option-row">
          <label for="min-score">Minimum score threshold</label>
          <input
            type="number"
            id="min-score"
            class="text-input"
            placeholder="0"
            min="-999"
            max="999999"
            style="max-width: 150px"
          />
          <p class="option-description">
            Posts with scores below this value will be hidden. Default: 0 (hide
            negative posts).
          </p>
        </div>
      </section>

      <!-- Muted Domains -->
      <section class="setting">
        <h2>Muted Domains</h2>
        <p class="section-description">
          Hide posts linking to specific domains. Useful for filtering clickbait
          sites or content from sources you want to avoid. Supports wildcard
          subdomains (e.g., *.example.com).
        </p>

        <div class="whitelist-container">
          <div class="whitelist-input-row">
            <input
              type="text"
              id="domain-input"
              class="text-input"
              placeholder="example.com or *.example.com"
            />
            <button class="button" id="add-domain">Mute</button>
          </div>

          <ul id="domain-list" class="tag-list">
            <!-- Populated by JS -->
          </ul>

          <p class="empty-state" id="domain-empty">
            No muted domains. All post domains will be shown.
          </p>
        </div>

        <div class="muted-actions">
          <button class="button secondary" id="export-domains">
            üì• Export List
          </button>
          <button class="button secondary" id="import-domains">
            üì§ Import List
          </button>
          <input
            type="file"
            id="import-domains-file"
            accept=".json"
            style="display: none"
          />
        </div>
      </section>

      <!-- Reading History -->
      <section
        class="setting"
        role="region"
        aria-labelledby="reading-history-heading"
      >
        <h2 id="reading-history-heading">Reading History</h2>
        <p class="section-description">
          Track posts you've read for easy reference. All history is stored
          locally and never leaves your browser.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="reading-history-enabled" />
            <span>Enable reading history</span>
          </label>
          <p class="help-text">
            Track which posts you've viewed. History is stored locally only.
          </p>
        </div>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="show-visited-indicator" />
            <span>Show visited indicator on posts</span>
          </label>
          <p class="help-text">
            Display a checkmark (‚úì) next to posts you've already read.
          </p>
        </div>

        <div class="option-row">
          <label for="history-retention-days">Keep history for</label>
          <select id="history-retention-days" class="select-input">
            <option value="7">7 days</option>
            <option value="14">14 days</option>
            <option value="30">30 days</option>
            <option value="60">60 days</option>
            <option value="90">90 days</option>
          </select>
        </div>

        <div class="stats-grid" style="margin-top: 15px">
          <div class="stat-card">
            <div class="stat-label">Posts in History</div>
            <div class="stat-value" id="history-entry-count">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Most Recent</div>
            <div class="stat-value stat-value-small" id="history-last-viewed">
              Never
            </div>
          </div>
        </div>

        <!-- History Table -->
        <div class="subsection">
          <h3>Recent History</h3>
          <div class="search-box">
            <input
              type="text"
              id="history-search"
              class="search-input"
              placeholder="Search history..."
            />
          </div>
          <div id="history-table-container">
            <table id="history-table" class="data-table">
              <thead>
                <tr>
                  <th>Post</th>
                  <th>Subreddit</th>
                  <th>Viewed</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="history-tbody">
                <!-- History entries will be inserted here -->
              </tbody>
            </table>
            <p id="history-empty" class="empty-message" style="display: none">
              No posts in reading history yet.
            </p>
          </div>
        </div>

        <div class="button-row" style="margin-top: 15px">
          <button id="clear-reading-history" class="secondary-button">
            Clear All History
          </button>
          <button id="export-reading-history" class="secondary-button">
            Export History
          </button>
          <button id="import-reading-history-btn" class="secondary-button">
            Import History
          </button>
          <input
            type="file"
            id="import-reading-history-file"
            accept=".json"
            style="display: none"
          />
        </div>
      </section>

      <!-- NSFW Controls -->
      <section
        class="setting"
        role="region"
        aria-labelledby="nsfw-controls-heading"
      >
        <h2 id="nsfw-controls-heading">NSFW Content Controls</h2>
        <p class="section-description">
          Control how NSFW (Not Safe For Work) content is displayed on Reddit.
          You can blur, hide, or show NSFW posts, with options for per-subreddit
          exceptions.
        </p>

        <div class="option-row">
          <label class="checkbox-label">
            <input type="checkbox" id="nsfw-controls-enabled" />
            <span>Enable NSFW content controls</span>
          </label>
          <p class="help-text">
            When disabled, NSFW content is shown normally (Reddit's default
            behavior).
          </p>
        </div>

        <div class="option-row" id="nsfw-visibility-row">
          <label for="nsfw-visibility">NSFW Visibility</label>
          <select
            id="nsfw-visibility"
            class="select-input"
            aria-describedby="nsfw-visibility-desc"
          >
            <option value="show">Show (no filtering)</option>
            <option value="blur">Blur (images are blurred)</option>
            <option value="hide">Hide (posts are hidden)</option>
          </select>
          <p class="option-description" id="nsfw-visibility-desc">
            Choose how to handle NSFW content. "Blur" obscures images but keeps
            posts visible. "Hide" removes NSFW posts from your feed entirely.
          </p>
        </div>

        <div class="option-row" id="nsfw-blur-options">
          <label for="nsfw-blur-intensity">Blur Intensity</label>
          <div class="range-container">
            <input
              type="range"
              id="nsfw-blur-intensity"
              min="5"
              max="20"
              value="10"
              class="range-input"
            />
            <span id="nsfw-blur-intensity-value">10px</span>
          </div>
          <p class="help-text">
            How much to blur NSFW images. Higher values = more blur.
          </p>
        </div>

        <div class="option-row" id="nsfw-hover-row">
          <label class="checkbox-label">
            <input type="checkbox" id="nsfw-reveal-hover" checked />
            <span>Reveal on hover</span>
          </label>
          <p class="help-text">
            Temporarily reveal blurred NSFW content when hovering over it.
          </p>
        </div>

        <div class="option-row" id="nsfw-warning-row">
          <label class="checkbox-label">
            <input type="checkbox" id="nsfw-show-warning" checked />
            <span>Show NSFW warning overlay</span>
          </label>
          <p class="help-text">
            Display a "18+ NSFW" badge on blurred thumbnails. Click to
            temporarily reveal.
          </p>
        </div>

        <!-- NSFW Allowed Subreddits -->
        <div class="subsection">
          <h3>Allowed Subreddits</h3>
          <p class="help-text">
            NSFW content will always be shown (not blurred/hidden) in these
            subreddits. Use this for subreddits you trust or where NSFW tagging
            is inconsistent.
          </p>
          <div class="input-group">
            <input
              type="text"
              id="nsfw-allowed-subreddit"
              placeholder="Enter subreddit name (e.g., art)"
              class="text-input"
              aria-label="Subreddit name to allow"
            />
            <button id="add-nsfw-allowed" class="primary-button">Add</button>
          </div>
          <div class="tag-list" id="nsfw-allowed-list">
            <!-- Populated by JavaScript -->
          </div>
          <p id="nsfw-allowed-empty" class="empty-message">
            No subreddits added yet. NSFW controls apply everywhere.
          </p>
        </div>

        <div class="button-row" style="margin-top: 15px">
          <button id="clear-nsfw-allowed" class="secondary-button">
            Clear All Allowed Subreddits
          </button>
        </div>
      </section>

      <!-- Storage Management -->
      <section class="setting">
        <h2>Storage Management</h2>
        <p class="section-description">
          Monitor storage usage and optimize performance. The extension uses
          both local storage and sync storage (when enabled).
        </p>

        <!-- Storage Health Status -->
        <div
          id="storage-health-banner"
          class="health-banner"
          style="display: none"
        >
          <span class="health-icon" id="storage-health-icon"></span>
          <span class="health-message" id="storage-health-message"></span>
        </div>

        <!-- Storage Usage Overview -->
        <div class="storage-overview">
          <div class="storage-meters">
            <div class="storage-meter-group">
              <div class="meter-header">
                <span class="meter-label">Local Storage</span>
                <span class="meter-value" id="local-storage-value"
                  >0 KB / 5 MB</span
                >
              </div>
              <div class="progress-bar">
                <div
                  class="progress-fill"
                  id="local-storage-bar"
                  style="width: 0%"
                ></div>
              </div>
            </div>

            <div class="storage-meter-group">
              <div class="meter-header">
                <span class="meter-label">Sync Storage</span>
                <span class="meter-value" id="sync-storage-value"
                  >0 KB / 100 KB</span
                >
              </div>
              <div class="progress-bar">
                <div
                  class="progress-fill"
                  id="sync-storage-bar"
                  style="width: 0%"
                ></div>
              </div>
            </div>
          </div>

          <!-- Storage Breakdown -->
          <div class="storage-breakdown">
            <h3>Storage Breakdown</h3>
            <div class="breakdown-grid" id="storage-breakdown-grid">
              <!-- Populated by JavaScript -->
            </div>
          </div>

          <!-- Item Counts -->
          <div class="storage-counts">
            <h3>Feature Usage</h3>
            <div class="counts-grid">
              <div class="count-item">
                <span class="count-label">User Tags</span>
                <span class="count-value" id="count-user-tags">0/500</span>
              </div>
              <div class="count-item">
                <span class="count-label">Muted Users</span>
                <span class="count-value" id="count-muted-users">0/500</span>
              </div>
              <div class="count-item">
                <span class="count-label">Sort Preferences</span>
                <span class="count-value" id="count-sort-prefs">0/100</span>
              </div>
              <div class="count-item">
                <span class="count-label">Scroll Positions</span>
                <span class="count-value" id="count-scroll-pos">0/100</span>
              </div>
              <div class="count-item">
                <span class="count-label">Layout Presets</span>
                <span class="count-value" id="count-presets">0/20</span>
              </div>
              <div class="count-item">
                <span class="count-label">Muted Subreddits</span>
                <span class="count-value" id="count-muted-subs">0/100</span>
              </div>
            </div>
          </div>

          <!-- Cleanup Actions -->
          <div class="storage-actions">
            <h3>Optimization</h3>
            <p class="help-text">
              Clean up expired data to free storage space and improve
              performance.
            </p>
            <div class="button-row">
              <button id="run-storage-cleanup" class="button">
                Run Cleanup
              </button>
              <button id="run-storage-maintenance" class="secondary-button">
                Full Maintenance
              </button>
              <button id="refresh-storage-stats" class="secondary-button">
                Refresh Stats
              </button>
            </div>
            <p
              class="cleanup-result"
              id="cleanup-result"
              style="display: none"
            ></p>
          </div>
        </div>
      </section>

      <!-- URL Testing Tool -->
      <section class="setting">
        <h2>Test a URL</h2>
        <p class="section-description">
          Check if a URL would be redirected before visiting it.
        </p>

        <div class="url-test-container">
          <div class="input-row">
            <input
              type="url"
              id="test-url-input"
              class="text-input"
              placeholder="https://reddit.com/r/news"
            />
            <button class="button" id="test-url-btn">Test</button>
          </div>

          <div class="test-result" id="test-result" hidden>
            <div class="result-icon" id="result-icon"></div>
            <div class="result-text">
              <p id="result-message"></p>
              <p class="result-detail" id="result-detail"></p>
            </div>
          </div>
        </div>
      </section>

      <!-- Keyboard Shortcut -->
      <section class="setting">
        <div class="setting-row">
          <div class="setting-info">
            <label>Keyboard Shortcut</label>
            <p class="description">
              Toggle redirect on/off with
              <kbd id="shortcut-display">Alt+Shift+R</kbd>
            </p>
          </div>
          <a href="#" id="customize-shortcut" class="button">Customize</a>
        </div>
      </section>

      <!-- Backup & Restore -->
      <section class="setting">
        <h2>Backup & Restore</h2>

        <div class="backup-actions">
          <button class="button" id="export-settings">
            üì§ Export Settings
          </button>
          <button class="button secondary" id="import-settings">
            üì• Import Settings
          </button>
        </div>

        <input
          type="file"
          id="import-file"
          accept=".json,application/json"
          hidden
        />

        <p class="help-text">
          Export your settings to a JSON file. Import to restore or share
          configurations. Statistics are not included in exports.
        </p>
      </section>

      <!-- Sync Settings -->
      <section class="setting">
        <h2>Sync Settings</h2>
        <div class="setting-row">
          <div class="setting-info">
            <label for="sync-toggle">Sync across browsers</label>
            <p class="description">
              Sync your preferences across Chrome/Edge browsers signed into the
              same account. Statistics are never synced.
            </p>
          </div>
          <label class="switch">
            <input type="checkbox" id="sync-toggle" />
            <span class="slider"></span>
          </label>
        </div>
        <p class="sync-status" id="sync-status">
          <!-- "Last synced: 2 minutes ago" or "Not synced" -->
        </p>
      </section>

      <!-- Keyboard Shortcuts -->
      <section class="setting">
        <h2>Keyboard Shortcuts</h2>

        <div class="setting-row">
          <div class="setting-info">
            <label for="keyboard-shortcuts-enabled"
              >Enable keyboard shortcuts</label
            >
            <p class="description">
              Use keyboard shortcuts to quickly navigate and control the
              extension
            </p>
          </div>
          <label class="switch">
            <input type="checkbox" id="keyboard-shortcuts-enabled" />
            <span class="slider"></span>
          </label>
        </div>

        <div id="keyboard-shortcuts-settings" style="display: none">
          <!-- Chord timeout setting -->
          <div class="setting-row">
            <div class="setting-info">
              <label for="chord-timeout">Chord timeout (ms)</label>
              <p class="description">
                Time to wait between keys in chord shortcuts (e.g., "g g")
              </p>
            </div>
            <input
              type="number"
              id="chord-timeout"
              min="500"
              max="3000"
              step="100"
              style="
                width: 100px;
                padding: 8px;
                border: 1px solid #ccc;
                border-radius: 4px;
              "
            />
          </div>

          <!-- Conflict warning banner -->
          <div
            id="keyboard-conflicts-warning"
            class="warning-banner"
            style="display: none"
          >
            <strong>‚ö†Ô∏è Keyboard Shortcut Conflicts Detected</strong>
            <p id="keyboard-conflicts-message"></p>
          </div>

          <!-- Shortcuts table -->
          <div class="shortcuts-table-container">
            <table class="shortcuts-table">
              <thead>
                <tr>
                  <th>Action</th>
                  <th>Keys</th>
                  <th>Context</th>
                  <th>Enabled</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="shortcuts-table-body">
                <!-- Populated by JavaScript -->
              </tbody>
            </table>
          </div>

          <!-- Action buttons -->
          <div class="keyboard-shortcuts-actions">
            <button id="keyboard-export-btn" class="secondary-button">
              Export Shortcuts
            </button>
            <button id="keyboard-import-btn" class="secondary-button">
              Import Shortcuts
            </button>
            <button id="keyboard-reset-all-btn" class="danger-button">
              Reset All to Defaults
            </button>
          </div>
          <input
            type="file"
            id="keyboard-import-file"
            accept=".json"
            style="display: none"
          />
        </div>

        <p class="help-text">
          Customize keyboard shortcuts to match your preferences. Press Shift+/
          on any Reddit page to see the help overlay.
        </p>
      </section>

      <!-- Keyboard Shortcut Edit Modal -->
      <div id="keyboard-edit-modal" class="modal" style="display: none">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Edit Keyboard Shortcut</h3>
            <button class="modal-close" id="keyboard-edit-close">
              &times;
            </button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>Action</label>
              <p
                id="keyboard-edit-action-name"
                class="keyboard-action-display"
              ></p>
            </div>
            <div class="form-group">
              <label for="keyboard-edit-keys">Keys</label>
              <div class="keyboard-capture-container">
                <input
                  type="text"
                  id="keyboard-edit-keys"
                  class="keyboard-capture-input"
                  placeholder="Press keys or type combination..."
                  autocomplete="off"
                />
                <p class="keyboard-capture-hint">
                  Click and press your desired key combination, or type it
                  manually (e.g., "Ctrl+K", "G G")
                </p>
              </div>
              <p id="keyboard-edit-validation" class="validation-message"></p>
            </div>
            <div class="form-group">
              <label>Context</label>
              <p
                id="keyboard-edit-context"
                class="keyboard-context-display"
              ></p>
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="keyboard-edit-enabled" />
                Enable this shortcut
              </label>
            </div>
          </div>
          <div class="modal-footer">
            <button id="keyboard-edit-save" class="primary-button">Save</button>
            <button id="keyboard-edit-reset" class="secondary-button">
              Reset to Default
            </button>
            <button id="keyboard-edit-cancel" class="secondary-button">
              Cancel
            </button>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <footer>
        <p>
          <a
            href="https://github.com/tom-james-watson/old-reddit-redirect"
            target="_blank"
            >View on GitHub</a
          >
          &bull;
          <a
            href="https://github.com/tom-james-watson/old-reddit-redirect/blob/master/PRIVACY.md"
            target="_blank"
            >Privacy Policy</a
          >
        </p>
      </footer>

      <!-- Toast notification -->
      <div id="toast" class="toast" hidden>
        <span id="toast-message"></span>
      </div>
    </div>
    <script src="logger.js"></script>
    <script src="storage.js"></script>
    <script src="suggestions.js"></script>
    <script src="frontends.js"></script>
    <script src="options.js"></script>
  </body>
</html>
